\documentclass[12pt,fleqn]{article}
\usepackage{../../vkCourseML}
%\usepackage{vkCourseML}
\hypersetup{unicode=true}
%\usepackage[a4paper]{geometry}
\usepackage[hyphenbreaks]{breakurl}

\interfootnotelinepenalty=10000
\newcommand{\dx}[1]{\,\mathrm{d}#1} % маленький отступ и прямая d


\begin{document}
	


Анализ временных рядов в большинстве своих приложений является частным случаем  стандартной задачи регрессии или классификации. Вместо независимых наблюдений в кросс-секционных данных мы рассматриваем одну или несколько последовательностей точек. Подобные данные встречаются во многих областях.
\begin{example}
	Группа компаний Y6 хочет уметь для каждого своего магазина оценивать спрос по всем товарам, чтобы оптимизировать поставки. Из кассовой системы известны продажи за предыдущие дни. Требуется построить модель, которая по каждому товару для каждого магазина будет выдавать прогноз на фиксированный горизонт. Хорошая модель оценки спроса поможет ритейлеру оптимизировать цепочки поставок и избежать \href{https://ardma.ru/marketing/osnovy-marketinga/effekt-khlysta/}{эффекта хлыста}.
\end{example}

\begin{example}
	ВыньДаПоложьБанк хочет спрогнозировать свою выручку. На основе данных о выданных кредитах, хранящихся депозитах, сроках их погашения и т.п. банк может по-отдельности спрогнозировать эти компоненты и с помощью простой иерархической модели построить прогноз для общей выручки.
\end{example}

\begin{example}
	Иннокентий Чёрнодыров получает сигнал от исследовательского спутника, который собирает данные о солнечной активности. Так как в космосе присутствует излучение, вносящее помехи в работу датчиков, Иннокентию придётся внимательно изучать временной ряд на наличие выбросов, аномалий и пропусков в наблюдениях.
\end{example}


Введём определение случайного процесса и временного ряда.  Наши определения будут достаточно нестроги, но мы осознанно пойдём на это и оставим коллегам с профильных курсов право сделать это за нас.

\section{Определения}

\begin{definition}
	Случайный процесс -- это \emph{последовательность} случайных величин $Y_t$, где $t$ -- некоторая дискретная шкала времени. 
\end{definition}

Мы специально сконцентрируемся только на дискретных последовательностях с вещественными значениями, так как для большинства задач этого достаточно. Непрерывные модели в приложениях встречаются редко из-за сложностей в оценке и в целом необходимости их оценки. Следовательно, временным рядом мы будем называть некоторую \emph{реализацию} случайного процесса, $y_t$. Иногда эту реализацию ещё называют траекторией. Также можно встретить определение, что временной ряд это и есть случайный процесс (последовательность случайных велечин), но с практической точки зрения это немного не интуитивно и мы постараемся этого избегать.

На практике обычно мы имеем дело с последовательностями с конечным числом элементов $(y_t)_{t=1}^{T}$, где T -- количество наблюдений. Иногда в учебных целях иногда будем затрагивать последовательности с бесконечным числом элементов: $(y_t)_{t=1}^{t=+\infty}$ или $(y_t)_{t=-\infty}^{t=+\infty}$

В классических моделях машинного обучения мы предполагали наблюдения в обучающей выборке независимыми и одинаково распределёнными: $X = \{(x_1, y_1), \dots, (x_\ell, y_\ell)\}$. Однако от этих предпосылок нам придётся отказаться. Почти всегда элементы последовательности будут зависимы между собой и нашей задачей будет выяснить характер этой связи. Грубо говоря, нам необходимо восстановить характеристики случайного процесса по сгенерированной тракетории. Да, наличие структуры в данных не позволяет нам напрямую использовать стандартные техники машинного обучения, но в то же время из этой структуры можно выделить много дополнительной и полезной для прогнозирования информации.


Можем ли мы в принципе быть уверены, что сможем его восстановить? В какой-то мере ответ на это даёт Теорема Дуба о разложении \cite{doob}. Говоря в очень упрощённых терминах, она говорит о том, что почти любой "хороший"\ процесс можно разложить на прогнозируемую (детерминированную) и принципиально непрогнозируемую части. Следственно, мы никогда не сможем восстановить процесс идеально. Но тем не менее, часть процессов более склонна к детерминированному поведению, а часть -- менее. Например дневная температура яввляется очень сезонной величиной, то есть имеет паттерн, удобный для прогнозирования. Мы будем учиться обнаруживать и выделять такие паттерны в данных. С другой стороны, котировки акций наиболее близки к хаотичному движению и весьма трудно поддаются прогнозированию. Этим занимаются скорее в области количественных финансов. В нашем курсе котировки акций могут быть рассмотрены скорее из-за удобства и качества данных, но не более чем для иллюстрации. Исключение составит тема прогнозирования волатильности.




\section{Возможные постановки задач}

Задачи на временных рядах можно рассматривать с двух сторон. Во-первых, их можно свести к стандартным методам машинного обучения с минимальными оговорками в подготовке данных. Во-вторых, можно рассматривать это направление как развивавшееся независимо в контексте эконометрических задач с уклоном в логику описания данных. Мы кратко поговорим про первый подход и более подробно про второй.

\subsection{Случай одного ряда}

Предположим, что весь наш набор данных состоит из одного временного ряда $(y_t)_{t=1}^{T}$.  На основе него можно сформулировать следующие задачи. 

\subsubsection{Прогнозирование}

Эта задача наиболее популярна. Нам необходимо на основе истории наблюдений и, возможно, каких-то дополнительных данных о внешнем мире предсказать будущие значения ряда. Точку $T$ в таком случае называют \emph{forecast origin}. Пусть мы хотим построить прогноз на $h$ шагов вперёд относительно $T$. Тогда h называется горизонтом прогнозирования, \emph{forecast horizon}. Ещё можно встретить в некоторых библиотеках (например, sktime) понятие абсолютного и относительного горизонта. $T+h$ мы будем называть абсолютным горизонтом, а $h$ относительным.

Прогнозы могут быть различными по форме, но по сути своей они обычно пытаются приблизить некоторую статистику от распределения $y_{t+h}$. Основных можно выделить три:

\begin{enumerate}
	\item Точечный прогноз
	
	Самый простой случай. Мы просто хотим узнать конкретное значение показателя в зависимости от периода. Самые популярные модели обычно приближают математическое ожидание или квантиль распределения. Например, ARIMA, пытается приближать условное математическое ожидание $\mathbb{E}(y_{T+h} | (y_t)_{t=1}^{T})$	
	
	% TODO: Сценарное прогнозирование? Здесь или где-то дальше?		
	
	\item Прогноз изменчивости
	
	Обычно под этим подразумевается прогноз дисперсии и некоторые производные от этого. Мы будем более подробно говорить про это в разделе про прогнозирование риска.
	
	\item Интервальный прогноз
	
	Это некоторая комбинация двух предыдущих случаев. Требуется предсказать интервал, в который попадёт $y_{t+h}$ с некоторой заданной вероятностью. Например, 95\%. Для явного вычисления требуется знать закон распределения $y_{t+h}  | (y_t)_{t=1}^{T}$ или по крайней мере иметь способ расчёта квантилей. Мы разберём такие примеры в разделе про ETS-модели. 
	
	Существуют также способы приближённого вычисления доверительных интервалов с помощью симуляций. Мы обсудим это в разделе про прогнозирование риска.
	
\end{enumerate}

\subsubsection{Заполнение пропусков}

В стандратных кросс-секционных данных наблюдения с пропусками иногда не критичны. Например, если их мало, то несколько наблюдений можно удалить, или если пропуски сами по себе являются признаком, то можно их учесть. Стандартные модели временных рядов основываются на том, что в данных нет пропусков и наблюдения расположены через равные промежутки времени. Следовательно, заполнение пропусков может быть вспомогательной задачей прогнозирования. Оно может быть и независимой задачей, если нам необходимо восстановить какие-либо зависимости в прошлом.

\subsubsection{Декомпозиция}

Благодаря наличию темпоральной структуры временные ряды обладают большим количеством паттернов. Существует несколько различных методов разложения одного ряда на составляющие его компоненты. Обычно выделяют четыре: тренд, сезонность, цикличность и остаток. Отдельные компоненты можно спрогнозировать более простыми моделями, а потом собрать прогноз воедино.



\subsubsection{Детекция разладки}

Пусть мы оценили прогнозную модель для какого-либо ряда. Однако с появлением новых наблюдений модель можно переоценить, чтобы учесть всю актуальную информацию. Однако характеристики наблюдаемых процессов могут меняться со временем. Это означает, что предпосылки, на основе которых мы оценивали исходную модель могут стать не актуальными. Задача определения этого факта, а также точки во времени, когда он произошёл, и есть задача детекции разладки.

\subsubsection{Агрегация и дезагрегация}

Агрегация -- это переход от высокой частоты к низкой. Например, перевод часовых данных в дневные. Для этого перехода необходима функция агрегации, выбор которой должен быть согласован с логикой данных. Обычно это стандартные статистики: сумма, среднее, минимум, максимум и т.п.

Дезагрегация -- это переход от низкой частоты к высокой. Данная операция уже существенно более сложная и не имеет какой-то стандартной процедуры или очевидной логики. Обычно для проведения дезагрегации требуются прокси-ряды.

\begin{example}
Данные по ВВП выпускаются поквартально. Однако для оперативного экономического анализа в течение квартала хотелось бы получать представления о его динамике. Для этого можно воспользоваться компонентами ВВП, которые можно оценивать по крайней мере ежемесячно. Например, потребление или государственные расходы. 
\end{example}

\subsection{Случай набора рядов}

Для большого количества рядов можно решать все те же задачи, что и для отдельных рядов. Например, прогнозировать отдельно каждый показатель. Однако задача может усложняться, если ряды связаны между собой.

\subsubsection{Классификация}
Каждый временной ряд можно расценивать как отдельный объект, который можно классифицировать. 

\begin{example}
	Ваши умные часы или телефон постоянно собирают статистику: данные гироскопа, температуры, давления и т.п. Фитнес-трекер классифицирует эти данные по характеру колебаний и определяет, чем вы сейчас занимаетесь.
\end{example}

\subsubsection{Кластеризация}

Аналогично табличным задачам, после классификации следует упомянуть кластеризацию. Каких-то явных приложений и широкого применения я не встречал, но как вспомогательная задача выявления похожих рядов на неразмеченном массиве имеет место быть.

\subsubsection{Выявление связи между рядами}

Задача выявления связи чуть более тонкая чем "подобрать фичи для лучшего прогноза". Требуется максимально точно восстановить характер взаимосвязи переменных. Такой подход больше распространён в экономических приложениях и эконометрических задачах в частности. Мы немного поговорим об этом в главе про SVAR-модели.




\end{document}